<div class="container py-5">
  <div class="row justify-content-center">
    <div class="col-lg-8">
      <div class="card shadow-lg border-0">
        <div class="card-header bg-primary text-white py-4">
          <div class="text-center">
            <h2 class="mb-1">
              <i class="fas fa-road me-2"></i>إضافة رحلة جديدة
            </h2>
            <p class="mb-0">أضف رحلتك واجذب الركاب لمشاركة التكاليف</p>
          </div>
        </div>

        <div class="card-body p-5">
          <%= form_with(model: @ride, local: true, class: "needs-validation", novalidate: true) do |form| %>
            <% if @ride.errors.any? %>
              <div class="alert alert-danger">
                <h5>يوجد أخطاء يجب تصحيحها:</h5>
                <ul>
                  <% @ride.errors.full_messages.each do |message| %>
                    <li><%= message %></li>
                  <% end %>
                </ul>
              </div>
            <% end %>

            <div class="row">
              <div class="col-md-6 mb-4">
                <%= form.label :from_city, "المدينة المنطلقة", class: "form-label fw-bold text-primary" %>
                <div class="input-group">
                  <span class="input-group-text bg-light">
                    <i class="fas fa-map-marker-alt text-primary"></i>
                  </span>
                  <%= form.text_field :from_city, class: "form-control", required: true,
                                    placeholder: "أدخل المدينة المنطلقة" %>
                </div>
              </div>

              <div class="col-md-6 mb-4">
                <%= form.label :to_city, "المدينة الواصلة", class: "form-label fw-bold text-primary" %>
                <div class="input-group">
                  <span class="input-group-text bg-light">
                    <i class="fas fa-map-marker-alt text-primary"></i>
                  </span>
                  <%= form.text_field :to_city, class: "form-control", required: true,
                                    placeholder: "أدخل المدينة الواصلة" %>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-4">
                <%= form.label :departure_time, "تاريخ ووقت المغادرة", class: "form-label fw-bold text-primary" %>
                <div class="input-group">
                  <span class="input-group-text bg-light">
                    <i class="fas fa-calendar-alt text-primary"></i>
                  </span>
                  <%= form.datetime_local_field :departure_time, class: "form-control", required: true,
                                              min: Time.now.strftime("%Y-%m-%dT%H:%M") %>
                </div>
              </div>

              <div class="col-md-6 mb-4">
                <%= form.label :available_seats, "عدد المقاعد المتاحة", class: "form-label fw-bold text-primary" %>
                <div class="input-group">
                  <span class="input-group-text bg-light">
                    <i class="fas fa-users text-primary"></i>
                  </span>
                  <%= form.number_field :available_seats, class: "form-control", required: true,
                                      min: 1, max: 10, placeholder: "عدد المقاعد" %>
                </div>
              </div>
            </div>

            <div class="row">
              <div class="col-md-6 mb-4">
                <%= form.label :price, "سعر المقعد (ل.س)", class: "form-label fw-bold text-primary" %>
                <div class="input-group">
                  <span class="input-group-text bg-light">
                    <i class="fas fa-money-bill-wave text-primary"></i>
                  </span>
                  <%= form.number_field :price, class: "form-control", required: true,
                                      min: 0, step: 500, placeholder: "السعر بالليرة السورية" %>
                </div>
              </div>
            </div>

            <div class="mb-4">
              <%= form.label :notes, "ملاحظات إضافية", class: "form-label fw-bold text-primary" %>
              <%= form.text_area :notes, class: "form-control", rows: 4,
                               placeholder: "أي معلومات إضافية عن الرحلة، نقطة التجمع، نوع السيارة، إلخ..." %>
              <div class="form-text">هذه المعلومات ستظهر للركاب المحتملين</div>
            </div>

            <div class="d-grid gap-2">
              <%= form.submit "إنشاء الرحلة", class: "btn btn-primary btn-lg fw-bold py-3" %>
              <%= link_to "إلغاء والعودة", rides_path, class: "btn btn-outline-secondary btn-lg" %>
            </div>
          <% end %>
        </div>
      </div>

      <div class="card mt-4">
        <div class="card-body">
          <h5 class="text-primary mb-3">💡 نصائح لإضافة رحلة ناجحة</h5>
          <ul class="list-unstyled">
            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>حدد سعراً مناسباً يجذب الركاب</li>
            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>أضف ملاحظات واضحة عن الرحلة</li>
            <li class="mb-2"><i class="fas fa-check-circle text-success me-2"></i>تأكد من صحة وقت المغادرة</li>
            <li><i class="fas fa-check-circle text-success me-2"></i>حدد عدد المقاعد بدقة</li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.card {
  border-radius: 15px;
  overflow: hidden;
}

.card-header {
  border-radius: 15px 15px 0 0 !important;
}

.form-control:focus {
  border-color: #0d6efd;
  box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25);
}

.input-group-text {
  background-color: #f8f9fa;
  border-right: none;
}

.btn-lg {
  border-radius: 12px;
  font-size: 1.1rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // التحقق من صحة النموذج
  const forms = document.querySelectorAll('.needs-validation');
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault();
        event.stopPropagation();
      }
      form.classList.add('was-validated');
    }, false);
  });

  // تعيين الحد الأدنى للتاريخ إلى اليوم
  const now = new Date();
  const minDate = now.toISOString().slice(0, 16);
  document.getElementById('ride_departure_time').min = minDate;
});
</script>
