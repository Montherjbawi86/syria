<div class="container-fluid py-4">
  <div class="row">
    <div class="col-12">
      <!-- العنوان -->
      <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h2 text-primary">
          <i class="fas fa-crown me-2"></i>لوحة تحكم المدير
        </h1>
        <span class="badge bg-warning text-dark">
          <i class="fas fa-user-shield me-1"></i>مدير النظام
        </span>
      </div>

      <!-- الإحصائيات -->
      <div class="row mb-5">
        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                  <h6 class="text-muted mb-1">المستخدمين</h6>
                  <h3 class="mb-0"><%= @users_count %></h3>
                </div>
                <div class="flex-shrink-0">
                  <div class="bg-primary text-white rounded-circle p-3">
                    <i class="fas fa-users fa-2x"></i>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <%= link_to admin_users_path, class: "btn btn-primary btn-sm w-100" do %>
                  <i class="fas fa-list me-1"></i>عرض الكل
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                  <h6 class="text-muted mb-1">الرحلات</h6>
                  <h3 class="mb-0"><%= @rides_count %></h3>
                </div>
                <div class="flex-shrink-0">
                  <div class="bg-success text-white rounded-circle p-3">
                    <i class="fas fa-car fa-2x"></i>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <%= link_to admin_rides_path, class: "btn btn-success btn-sm w-100" do %>
                  <i class="fas fa-list me-1"></i>عرض الكل
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                  <h6 class="text-muted mb-1">الحجوزات</h6>
                  <h3 class="mb-0"><%= @bookings_count %></h3>
                </div>
                <div class="flex-shrink-0">
                  <div class="bg-info text-white rounded-circle p-3">
                    <i class="fas fa-ticket-alt fa-2x"></i>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <%= link_to admin_bookings_path, class: "btn btn-info btn-sm w-100" do %>
                  <i class="fas fa-list me-1"></i>عرض الكل
                <% end %>
              </div>
            </div>
          </div>
        </div>

        <div class="col-xl-3 col-md-6 mb-4">
          <div class="card border-0 shadow-sm h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="flex-grow-1">
                  <h6 class="text-muted mb-1">السائقين</h6>
                  <h3 class="mb-0"><%= @drivers_count %></h3>
                </div>
                <div class="flex-shrink-0">
                  <div class="bg-warning text-white rounded-circle p-3">
                    <i class="fas fa-id-card fa-2x"></i>
                  </div>
                </div>
              </div>
              <div class="mt-3">
                <%= link_to admin_users_path(role: 'driver'), class: "btn btn-warning btn-sm w-100" do %>
                  <i class="fas fa-list me-1"></i>عرض السائقين
                <% end %>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- المحتوى الرئيسي -->
      <div class="row">
        <!-- المستخدمين الجدد -->
        <div class="col-xl-6 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-primary text-white">
              <h6 class="mb-0">
                <i class="fas fa-user-plus me-1"></i>أحدث المستخدمين
              </h6>
            </div>
            <div class="card-body">
              <% if @recent_users.any? %>
                <div class="list-group list-group-flush">
                  <% @recent_users.each do |user| %>
                    <div class="list-group-item border-0 px-0 py-2">
                      <div class="d-flex align-items-center">
                        <div class="flex-grow-1">
                          <h6 class="mb-0"><%= user.name %></h6>
                          <small class="text-muted"><%= user.email %></small>
                        </div>
                        <div class="flex-shrink-0">
                          <span class="badge bg-<%= user_badge_color(user.role) %>">
                            <%= user.role %>
                          </span>
                        </div>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% else %>
                <p class="text-muted text-center">لا يوجد مستخدمين</p>
              <% end %>
            </div>
          </div>
        </div>

        <!-- الرحلات الحديثة -->
        <div class="col-xl-6 mb-4">
          <div class="card shadow-sm h-100">
            <div class="card-header bg-success text-white">
              <h6 class="mb-0">
                <i class="fas fa-car me-1"></i>أحدث الرحلات
              </h6>
            </div>
            <div class="card-body">
              <% if @recent_rides.any? %>
                <div class="list-group list-group-flush">
                  <% @recent_rides.each do |ride| %>
                    <div class="list-group-item border-0 px-0 py-2">
                      <div class="d-flex justify-content-between align-items-start">
                        <div>
                          <h6 class="mb-0"><%= ride.from_city %> → <%= ride.to_city %></h6>
                          <small class="text-muted">
                            بواسطة: <%= ride.driver.name %> |
                            <%= l(ride.departure_time, format: :short) if ride.departure_time %>
                          </small>
                        </div>
                        <span class="badge bg-info"><%= ride.available_seats %> مقاعد</span>
                      </div>
                    </div>
                  <% end %>
                </div>
              <% else %>
                <p class="text-muted text-center">لا يوجد رحلات</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <!-- الحجوزات الحديثة -->
      <div class="row mt-4">
        <div class="col-12">
          <div class="card shadow-sm">
            <div class="card-header bg-info text-white">
              <h6 class="mb-0">
                <i class="fas fa-ticket-alt me-1"></i>أحدث الحجوزات
              </h6>
            </div>
            <div class="card-body">
              <% if @recent_bookings.any? %>
                <div class="table-responsive">
                  <table class="table table-hover">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>الراكب</th>
                        <th>الرحلة</th>
                        <th>المقاعد</th>
                        <th>الحالة</th>
                        <th>التاريخ</th>
                      </tr>
                    </thead>
                    <tbody>
                      <% @recent_bookings.each do |booking| %>
                        <tr>
                          <td><%= booking.id %></td>
                          <td><%= booking.passenger.name %></td>
                          <td><%= booking.ride.from_city %> → <%= booking.ride.to_city %></td>
                          <td><%= booking.seats %></td>
                          <td>
                            <span class="badge bg-<%= booking_status_color(booking.status) %>">
                              <%= booking.status %>
                            </span>
                          </td>
                          <td><%= l(booking.created_at, format: :short) %></td>
                        </tr>
                      <% end %>
                    </tbody>
                  </table>
                </div>
              <% else %>
                <p class="text-muted text-center">لا يوجد حجوزات</p>
              <% end %>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
.card {
  transition: transform 0.2s ease;
}

.card:hover {
  transform: translateY(-2px);
}

.badge {
  font-size: 0.75em;
}

.table th {
  border-top: none;
  font-weight: 600;
  color: #495057;
}

.list-group-item {
  border-left: none;
  border-right: none;
}

.list-group-item:first-child {
  border-top: none;
}

.list-group-item:last-child {
  border-bottom: none;
}
</style>
